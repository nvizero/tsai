

<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">待出貨明細</h3>
                    <div class="btn-group" id='head_btn'>
                        <button type="button" class="btn btn-info"><%=(@flag=='Y')?('未停用'):('停用') %></button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li><%= link_to '未停用', {:controller =>'product_orders' , :action =>'index' , :state =>'Y'}  %></li>
                            <li><%= link_to '停用', {:controller =>'product_orders' , :action =>'index' , :state =>'N'}  %></li>
                        </ul>
                    </div>


                    <%= link_to '新增訂單', new_product_order_path ,:class=>'btn btn-success',:id=>'head_btn' %>




            </div><!-- /.box-header -->
            <div class="box-body table-responsive">


<table id="example2" class="table table-bordered table-striped">
  <thead>
    <tr>
      <th><%= sortable "code" ,'訂單編號' %>     </th>
      <th>客戶</th>
      <th>產品</th>
      <th><%= sortable "num" ,'產品數量' %> </th>
      <th><%= sortable "order_day" ,'訂單日期' %>     </th>
      <th><%= sortable "future_day" ,'預定交貨日期' %>     </th>

      <th>確認</th>


    </tr>
  </thead>

  <tbody>
    <% @product_orders.each do |product_order| %>

    <% opbs = search_order_by_product( product_order.code) %>
    <% opbs = opbs.to_a.sort %>
    <% opbs.each do |obp|%>

    <%= render 'comm/info' , :info => obp , :users => @users_a , :title => "#{obp.id} 訊息"  %>
      <tr>
        <td>
          <%= product_order.code %>
        </td>

        <td>
          <%= product_order.member.name %>
        </td>
        <td><%= obp.product.title %></td>
        <td><%= obp.num %></td>


        <td>

          <%= product_order.order_day %>
        </td>
        <td><%= product_order.future_day  %>     </td>


        <td>
            <% link_to 'Show', product_order %>
            <% link_to 'Edit', edit_product_order_path(product_order) %>
            <% link_to 'Destroy', product_order, method: :delete, data: { confirm: 'Are you sure?' } %>
              <a url="#" class="btn confirm_order btn-primary btn-sm" id="<%=obp.id %>" > 確認 </a>
              <a class="btn btn-warning info" id="<%=obp.id %>" >訊息</a>
        </td>

      </tr>

      <% end %>

    <% end %>
  </tbody>
</table>
<%= paginate @product_orders  %>
</div>

<script src="/admin/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript">
$('document').ready(function(){

    $(".confirm_order").click(function(){

          var order_by_product_id = $(this).attr('id');

          $.post('/post_to_out_order',
                {'order_by_product_id':order_by_product_id},
                function(data){
                  alert(data);
                });




    });


    // $('.del').click(function(){
    //     var url = $(this).attr('id');
    //     var n =confirm('確定停用！？');
    //
    //     if(n){
    //         document.location.href=url;
    //     }
    // });


    $('.info').click(function(){
        var t_id = $(this).attr('id');
        // alert(t_id)
        $('#info-modal'+t_id).modal('show');
    });


})
</script>

</div>
</div>
</div>
</section><!-- /.content -->
